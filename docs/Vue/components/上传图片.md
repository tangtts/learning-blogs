# æ–‡ä»¶ä¸Šä¼ 
**å¯ä»¥ç‚¹å‡»/æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶**
[ğŸ”—element-plus](https://element-plus.gitee.io/zh-CN/component/upload.html)
## æ•ˆæœ

<upload/>
<script setup>
import upload from '../../../src/components/upload.vue'
</script>

## æ€è·¯
### 1. é€‰æ‹©æ–‡ä»¶  
åªæœ‰ `<input type="file">` å¯ä»¥é€‰æ‹©æ–‡ä»¶,ä½†æ˜¯`input` æ ‡ç­¾æ˜¯æµè§ˆå™¨åŸç”Ÿç»„ä»¶,æ— æ³•ä¿®æ”¹æ ·å¼,æ‰€ä»¥ä½¿ç”¨`<input type="file" hidden>`éšè—,ä¹Ÿå¯ä»¥ä½¿ç”¨ `display:none`éšè—

åœ¨ç‚¹å‡»å…¶ä»–å…ƒç´ è§¦å‘ input çš„ **`change`** äº‹ä»¶,ä¹Ÿæœ‰ä¸¤ç§æ–¹å¼

 #### 1. ä½¿ç”¨ `label` æ ‡ç­¾,ç‚¹å‡» label è§¦å‘ input çš„ change äº‹ä»¶
   ```html
    <label for="input">   //[!code hl]
        <span>é€‰æ‹©æ–‡ä»¶ </span>
        <input id="input" type="file" 
        @change="changeFileInput" 
        hidden 
        :multiple="multiple" 
        ref="inputRef">
      </label>
  ``` 
 #### 2. ä½¿ç”¨ `$refs` è·å–å…ƒç´ ,è§¦å‘ change äº‹ä»¶
   ```vue
    <template>
        <div>
          <el-button @click="handleClick">é€‰æ‹©æ–‡ä»¶</el-button>
          <input id="input" type="file" @change="changeFileInput" hidden :multiple="multiple" ref="inputRef">
        </div>
      </template>
      <script>
        const inputRef = ref(null)
        const handleClick = () => {
          inputRef.value!.click()
        }
      </script>
  ```
### 2. è·å–æ–‡ä»¶
åœ¨ `input` çš„ `change` äº‹ä»¶ä¸­,æœ‰ä¸€ä¸ªå‚æ•° `(e.target as HTMLInputElement).files` ä»£è¡¨äº†æ‰€é€‰çš„æ–‡ä»¶    

å¯¹æ‰€é€‰çš„æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ·»åŠ å”¯ä¸€æ ‡è¯† uid(`file.uid = Date.now()`),ä¾¿äºä»¥ååˆ é™¤

### 3. å±•ç¤ºæ–‡ä»¶
 [`URL.createObjectURL`](https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL_static) æ¥æ”¶ `file/blob` ä½œä¸ºå‚æ•°,è¿”å›ä¸€ä¸ª `URL` å¯¹è±¡,è¿™ä¸ª `URL` å¯¹è±¡å¯ä»¥ä½œä¸º `<img>` çš„ `src`

### 4. æ‹–æ‹½ä¸Šä¼ 
  ä½¿ç”¨ `@drop.prevent="dragFile"/@dragleave.prevent/@dragover.prevent` äº‹ä»¶è¿›è¡Œç›‘å¬æ˜¯å¦æœ‰æ–‡ä»¶æ‹–æ‹½åˆ°å…ƒç´ ä¸Š,ç”±äº`dragleave/dragover` çš„é»˜è®¤è¡Œä¸ºæ˜¯æ‰“å¼€æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦é˜»æ­¢é»˜è®¤è¡Œä¸º

åœ¨ `drop` äº‹ä»¶ä¸­è§¦å‘çš„ `dragFile` æ–¹æ³•ä¸­,ä½¿ç”¨ `event.dataTransfer.files` è·å–æ‰€æ‹–æ‹½çš„æ–‡ä»¶,å‰©ä¸‹çš„å’Œ input æµç¨‹ä¸€æ ·

### 5. åˆ é™¤æ–‡ä»¶
 ä¸»è¦æ˜¯é€šè¿‡å”¯ä¸€æ ‡è¯† `uid` è¿›è¡Œåˆ é™¤ï¼ŒåŒæ—¶ä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼Œéœ€è¦ä½¿ç”¨ `URL.revokeObjectURL` è§£é™¤å¼•ç”¨
 ```ts
  const deleteFile = (delfile: UploadFile) => {
    filesRef.value = filesRef.value.filter(file => delfile.uid !== file.uid)
    URL.revokeObjectURL(delfile.url)
  }
 ```
 ## æºç 
 <<< ../../../src/components/upload.vue