# å‘¨è¾¹åº“

## [ğŸ”—@reduxjs/toolkit](https://cn.redux.js.org/redux-toolkit/overview/)

```bash
pnpm i @reduxjs/toolkit react-redux
```

### åˆå§‹åŒ–
#### åˆ›å»º Redux Store
> app/store.js
```js
import { configureStore } from '@reduxjs/toolkit'

export default configureStore({
  reducer: {}
})
```

#### ä¸º React æä¾› Redux Store
> main.js

```js
import React from 'react'
import ReactDOM from 'react-dom'
import App from './App'

import store from './app/store' //[!code ++]
import { Provider } from 'react-redux' //[!code ++]

ReactDOM.render(
  <Provider store={store}> // [!code ++]
    <App />
  </Provider>, // [!code ++]
  document.getElementById('root')
)
```
#### åˆ›å»º Redux State Slice

åˆ›å»º slice éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²åç§°æ¥æ ‡è¯†åˆ‡ç‰‡ã€ä¸€ä¸ªåˆå§‹ state ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªå®šä¹‰äº†è¯¥å¦‚ä½•æ›´æ–° state çš„ reducer å‡½æ•°ã€‚slice åˆ›å»ºå ï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å‡º slice ä¸­ç”Ÿæˆçš„ Redux action creators å’Œ reducer å‡½æ•°ã€‚

Redux <blue>è¦æ±‚æˆ‘ä»¬é€šè¿‡åˆ›å»ºæ•°æ®å‰¯æœ¬å’Œæ›´æ–°æ•°æ®å‰¯æœ¬ï¼Œæ¥å®ç°ä¸å¯å˜åœ°å†™å…¥æ‰€æœ‰çŠ¶æ€æ›´æ–°ã€‚ä¸è¿‡ Redux Toolkit createSlice å’Œ createReducer åœ¨å†…éƒ¨ä½¿ç”¨ Immer å…è®¸æˆ‘ä»¬ç¼–å†™â€œå¯å˜â€çš„æ›´æ–°é€»è¾‘ï¼Œå˜æˆæ­£ç¡®çš„ä¸å¯å˜æ›´æ–°ã€‚</blue>


> features/counter/counterSlice.js
```js
import { createSlice } from '@reduxjs/toolkit'

export const counterSlice = createSlice({
  name: 'counter',
  initialState: {
    value: 0
  },
  reducers: {
    increment: state => {
      // Redux Toolkit å…è®¸æˆ‘ä»¬åœ¨ reducers å†™ "å¯å˜" é€»è¾‘ã€‚å®ƒ
      // å¹¶ä¸æ˜¯çœŸæ­£çš„æ”¹å˜çŠ¶æ€å€¼ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº† Immer åº“
      // å¯ä»¥æ£€æµ‹åˆ°â€œè‰ç¨¿çŠ¶æ€â€œ çš„å˜åŒ–å¹¶ä¸”åŸºäºè¿™äº›å˜åŒ–ç”Ÿäº§å…¨æ–°çš„
      // ä¸å¯å˜çš„çŠ¶æ€
      state.value += 1
    },
    decrement: state => {
      state.value -= 1
    },
    incrementByAmount: (state, action) => {
      state.value += action.payload
    }
  }
})
// æ¯ä¸ª case reducer å‡½æ•°ä¼šç”Ÿæˆå¯¹åº”çš„ Action creators
export const { increment, decrement, incrementByAmount } = counterSlice.actions

export default counterSlice.reducer
```
#### å°† Slice Reducers æ·»åŠ åˆ° Store ä¸­
> app/store.js
```js
import { configureStore } from '@reduxjs/toolkit'
import counterReducer from '../features/counter/counterSlice' //[!code ++]

export default configureStore({
  reducer: {
    counter: counterReducer //[!code ++]
  }
})
```
#### åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ Redux çŠ¶æ€å’Œæ“ä½œ
```js
import React from 'react'
import { useSelector, useDispatch } from 'react-redux' //[!code ++]
import { decrement, increment } from './counterSlice' //[!code ++]


export function Counter() {
  const count = useSelector(state => state.counter.value) //[!code ++]
  const dispatch = useDispatch() //[!code ++]

  return (
    <div>
      <div>
        <button
          aria-label="Increment value"
          onClick={() => dispatch(increment())} //[!code ++]
        >
          Increment
        </button>
        <span>{count}</span>
        <button
          aria-label="Decrement value"
          onClick={() => dispatch(decrement())} //[!code ++]
        >
          Decrement
        </button>
      </div>
    </div>
  )
}
```
### ç»“åˆts
> app/store.ts
```ts
import { configureStore } from '@reduxjs/toolkit'

const store = configureStore({
  reducer: {
    posts: postsReducer,
    comments: commentsReducer,
    users: usersReducer
  }
})

// ä» store æœ¬èº«æ¨æ–­å‡º `RootState` å’Œ `AppDispatch` ç±»å‹
export type RootState = ReturnType<typeof store.getState> //[!code ++]
// æ¨æ–­å‡ºç±»å‹: { posts: PostsState, comments: CommentsState, users: UsersState}
export type AppDispatch = typeof store.dispatch //[!code ++]
```
å®šä¹‰ slice state å’Œ action ç±»å‹
```ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit'
import type { RootState } from '../../app/store'

// ä¸º slice state å®šä¹‰ä¸€ä¸ªç±»å‹
interface CounterState { // [!code ++]
  value: number // [!code ++]
} // [!code ++]

// ä½¿ç”¨è¯¥ç±»å‹å®šä¹‰åˆå§‹ state
const initialState: CounterState = { // [!code ++]
  value: 0 // [!code ++]
} // [!code ++]

export const counterSlice = createSlice({
  name: 'counter',
  // `createSlice` å°†ä» `initialState` å‚æ•°æ¨æ–­ state ç±»å‹
  initialState,
  reducers: {
    increment: state => {
      state.value += 1
    },
    decrement: state => {
      state.value -= 1
    },
    // ä½¿ç”¨ PayloadAction ç±»å‹å£°æ˜ `action.payload` çš„å†…å®¹
    incrementByAmount: (state, action: PayloadAction<number>) => { // [!code ++]
      state.value += action.payload
    }
  }
})

export const { increment, decrement, incrementByAmount } = counterSlice.actions
// é€‰æ‹©å™¨ç­‰å…¶ä»–ä»£ç å¯ä»¥ä½¿ç”¨å¯¼å…¥çš„ `RootState` ç±»å‹
export const selectCount = (state: RootState) => state.counter.value // [!code ++]

export default counterSlice.reducer
```

å®šä¹‰ Hooks ç±»å‹

:::tip
å°½ç®¡ä½ å¯ä»¥å°† `RootState` å’Œ `AppDispatch` ç±»å‹å¯¼å…¥æ¯ä¸ªç»„ä»¶, æ›´å¥½çš„æ–¹å¼æ˜¯åˆ›å»º `useDispatch` å’Œ `useSelector` é’©å­çš„ç±»å‹å®šä¹‰ï¼Œä»¥ä¾¿åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼š

ç”±äºè¿™äº›æ˜¯å®é™…å˜é‡ï¼Œè€Œä¸æ˜¯ç±»å‹ï¼Œå› æ­¤å°†å®ƒä»¬å®šä¹‰åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­å¾ˆé‡è¦ï¼Œä¾‹å¦‚ `app/hooks.ts`ï¼Œè€Œä¸æ˜¯ `store` è®¾ç½®æ–‡ä»¶
:::
> app/hooks.ts

```ts
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'
import type { RootState, AppDispatch } from './store'

// åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯ç®€å•çš„ `useDispatch` å’Œ `useSelector`
export const useAppDispatch: () => AppDispatch = useDispatch
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ ‡æ³¨è¿‡ç±»å‹çš„é’©å­

```ts
import React from 'react'

import { useAppSelector, useAppDispatch } from 'app/hooks'

import { decrement, increment } from './counterSlice'

export function Counter() {
  // `state` å‚æ•°å·²æ­£ç¡®æ¨æ–­ä¸º `RootState` ç±»å‹
  const count = useAppSelector(state => state.counter.value) //[!code ++]
  const dispatch = useAppDispatch() // [!code ++]
}
```