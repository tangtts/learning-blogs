# å‡½æ•°

å…³äºå‡½æ•°çš„ä¸€åˆ‡,å‡½æ•°å®šä¹‰,å±æ€§,å¸¸ç”¨çš„å‡½æ•°ç¼–ç¨‹...

## ä½œç”¨åŸŸ

### å—çº§ä½œç”¨åŸŸ

`let` åˆ›å»ºå—çº§ä½œç”¨åŸŸçš„æ„æ€æ˜¯ä»¥ `{}`åŒ…è£¹å¯ä»¥å½¢æˆä¸€ä¸ªä»£ç å—ï¼Œæ¯”å¦‚åœ¨ `if/for` ä¸­, let åœ¨
è¯¥ä»£ç å—ä¸­æœ‰æ•ˆ

```js
if(true){
	let x = 10
}
// x is not defined
console.log(x) // [!code error]
```

### é™æ€ä½œç”¨åŸŸ

åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œå¸¦äº†ä¸€ä¸ª[[scope]]çš„å±æ€§,åŒ…å«ç€åˆ›å»ºæ—¶çš„è¯æ³•ç¯å¢ƒ; åœ¨å‡½æ•°åˆ›å»ºå·²ç»ç¡®å®šå¥½äº†å‡½æ•°çš„é™æ€ä½œç”¨åŸŸäº†  
 æ¯”å¦‚ `ä½ æ˜¯ä¸€ä¸ªæ²³å—äºº,åœ¨å‡ºç”Ÿçš„æ—¶å€™å·²ç»ç¡®å®šäº†,æœ‰äº›ä¸œè¥¿ä¸è®ºå¸¦åˆ°å“ªé‡Œéƒ½å»ä¸æ‰`
```js
// æ™®é€šå‡½æ•°
function ordinary() {
	return 'æˆ‘æ˜¯æ™®é€šçš„å‡½æ•°'
}
console.dir(ordinary)
// é—­åŒ…
function closure_Fn() {
	var num = 1
	return function () {
		return ++num
	}
}

var add = closure_Fn();
console.dir(add);
```

### â­åŠ¨æ€ä½œç”¨åŸŸ

:::tip 
ç‰¹æŒ‡ `this`,å¯ä»¥æ ¹æ®è°ƒç”¨æ–¹çš„ä¸åŒï¼Œåˆ‡æ¢ä¸åŒçš„æ‰§è¡Œç¯å¢ƒ,ä¹Ÿå°±æ˜¯ä¸Šä¸‹æ–‡,ä¹Ÿæ˜¯ **è°ƒç”¨è€…çš„åœ°å€å€¼**  

ç®­å¤´å‡½æ•°åœ¨åˆ›å»ºæ—¶å€™å°±å·²ç»ç¡®å®š`this`æŒ‡å‘,ã€Šå¼€å¢™é€ç»¿ã€‹

å›è°ƒå‡½æ•°ä¸­çš„ `this` æŒ‡å‘ window 
:::

```js
var name = 1;

var obj1 = {
	name:2,
	fn1:function(){
		console.log(this.name);
	},

	fn2:()=>console.log(this.name),

	fn3:function(){
		return function(){
			console.log(this.name)
		}
	},

	fn4:function(){
		// å’Œ fn4 çš„ this ä¿æŒä¸€è‡´
		return ()=>{
			console.log(this.name)
		}
	},
}

let obj2 ={
	name:3
}

// å‡½æ•° åœ¨ å †å†…å­˜é‡Œå­˜å‚¨
// fn1 -> æŒ‡å‘ä¸€ä¸ªåœ°å€ï¼Œ è¿™ä¸ªåœ°å€ æŒ‡å‘ è¿™ä¸ªå‡½æ•°åœ°å€
// æ‰€ä»¥å¯ä»¥åœ¨å…¶ä»–è°ƒç”¨ç¯å¢ƒä¸­æ‰§è¡Œ
// å…¶å®this æŒ‡å‘çš„ æ‰§è¡Œç¯å¢ƒ

obj1.fn1() // 2
obj1.fn1.call(obj2) // 3
obj1.fn2() // 1
obj1.fn2.call(obj2) // 1
obj1.fn3()() // 1
obj1.fn3.call(obj2)() // 1

obj1.fn4()() // 2
obj1.fn4.call(obj2)() // 3
```

## â­é—­åŒ…

:::tip 
	å‡½æ•°çš„å®šä¹‰å’Œæ‰§è¡Œä¸åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œå«åšé—­åŒ… ä»¥å‰çš„å®šä¹‰æ˜¯ å¤–å±‚å‡½æ•°å¼•ç”¨å†…
	éƒ¨å˜é‡,å¯¼è‡´å†…éƒ¨å˜é‡æ— æ³•é‡Šæ”¾
:::

```js
function after(times,callback){
 return function(){
   if(--times){
    callback()
  }
 }
}

let cb = atfter(2,function(){
  console.log(11)
})
```

## å‡½æ•°ç§‘é‡ŒåŒ–

:::tip 
	ç§‘é‡ŒåŒ–ï¼ˆCurryingï¼‰æ˜¯ä¸€ç§å°†æ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—åªæ¥å— å•ä¸ªå‚æ•° çš„å‡½æ•°çš„æŠ€æœ¯  
	å¦‚æœæ˜¯ å¤šä¸ªå‚æ•°ï¼Œå« åå‡½æ•°, å…ˆå›ºå®šéƒ¨åˆ†å‚æ•°ï¼Œä¹‹åå†ä¼ å…¥å…¶ä»–å‚æ•°  

	sum( 1, 2 )( 3 )è¿™ç§å«åå‡½æ•°  
	sum( 1 )( 2 )( 3 ) è¿™ç§å«ç§‘é‡ŒåŒ– 
:::

å…¶å®æ˜¯åˆ©ç”¨äº† é—­åŒ… æ•ˆæœå¯¹å‚æ•°è¿›è¡Œäº†ç¼“å­˜

```js
function add( a, b, c ){
	return a + b + c
}

function curry(fn){
	// è·å–å½¢å‚çš„é•¿åº¦
	let length = fn.length;
	return function c(...args){
		if(args.length < length){
			return (...rest)=> c(...rest,...args)
		}
		return  fn(...args)
	}
}

let c = curry(add)
console.log("ğŸš€ ~ file: index.js ~ line 78 ~ c(1,2,3)", c(1,2,3));
console.log("ğŸš€ ~ file: index.js ~ line 79 ~ c(1)(2,3)", c(1)(2,3));
console.log("ğŸš€ ~ file: index.js ~ line 80 ~ c()(1,2,3)", c()(1,2,3));
```

## ç®¡é“

fns å¦‚æœåªæœ‰ä¸€é¡¹çš„è¯ï¼Œæ˜¯ä¼šåŸè·¯è¿”å›ï¼Œä¸ä¼šæ‰§è¡Œ reduce æ–¹æ³•

```js
	function add1(a) {
  return a + 1
}
function add2(a) {
  return a + 2
}
function add3(a) {
  return a + 3
}


function pipe(...fns){
  // ä»å³åˆ°å·¦æ‰§è¡Œ
  // 1. a æ˜¯ add1,b æ˜¯ add2, è¿”å›ä¸€ä¸ª (...args)=> add1(add2(...args))
  // 2. a æ˜¯ (...args)=> add1(add2(...args)), b æ˜¯ add3, (...args)=> add1(add2(add3(args)))

  let res = fns.reduceRight((a,b)=>{
    return (...args) => a(b(...args))
  });
  return res
}
let fn =  pipe(add1,add2,add3)
let res = fn("abcd")
let fn2 =  pipe(add1)
let res2 = fn2(10) // 11
```

## pointFree(æ— æŒ‡å‘)

æˆ‘ä»¬åœ¨å¤„ç†æ•°æ®è¿‡ç¨‹,å®šä¹‰æˆä¸€ç§ä¸å‚æ•°æ— å…³çš„åˆæˆè¿ç®—ç®€å•æ¥è¯´: åªä½¿ç”¨å‡½æ•°è¿ç®—,ä¸å…³å¿ƒå€¼çš„ä¼ é€’

ä¾‹å­:

```js
var addOne = x => x + 1;
var square = x => x * x;

// åˆå¹¶æˆä¸€ä¸ªè¿ç®—

var addOneThenSquare = R.pipe(addOne, square);
addOneThenSquare(2) //  9
```

ä¸Šå±‚è¿ç®—ä¸ä¼šç›´æ¥æ“ä½œæ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡åº•å±‚å‡½æ•°å»å¤„ç†,è¿™å°±è¦æ±‚å°†ä¸€äº›å¸¸ç”¨çš„æ“ä½œå°è£…æˆå‡½æ•°

## å‡½å­

> å®ƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼ŒåŒ…å«äº†å€¼å’Œå€¼çš„å˜å½¢å…³ç³»ï¼ˆå˜å½¢å…³ç³»æŒ‡çš„æ˜¯å‡½æ•°ï¼‰ã€‚

### Pointed å‡½å­

> å®ç°äº† é™æ€æ–¹æ³• ofï¼Œå®ƒé¿å…äº†ä½¿ç”¨ new æ¥åˆ›å»ºå¯¹è±¡ï¼Œæ›´æ·±å±‚æ¬¡çš„å«ä¹‰æ˜¯ of æ–¹æ³•ç”¨æ¥
> æŠŠå€¼æ”¾åˆ°ä¸Šä¸‹æ–‡ context ä¸­ ï¼ˆå³ï¼šæŠŠä¸€ä¸ªå€¼æ”¾åˆ°å®¹å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ map æ–¹æ³•æ¥å¤„ç†å€¼
> ï¼‰

```js
class Pointed {
  // é™æ€æ–¹æ³•ï¼Œé¿å…ä½¿ç”¨ new æ¥åˆ›å»ºå¯¹è±¡
  static of (value) {
    return new Pointed(value)
  }

  constructor (value) {
    this._value = value
  }

  map (fn) {
    return Pointed.of(fn(this._value))
  }
}

let pointed = Pointed.of(3).map(val => val + 1).map(val => val * 2)

// è¾“å‡ºï¼šPointed { _value: 8 }
console.log(pointed)
```

### Maybe å‡½å­

```js
class MayBe {
  constructor(value){
    this.value  = value
  }
 static of(value){
    return new MayBe(value)
  }
  map(fn){
   return this.value ?  new MayBe(fn(this.value)) : this
  }
}
let r =  MayBe.of(10).map(x=>x+2 )
console.log(r.value)
```

## æƒ°æ€§å‡½æ•°

```js
let reg = false;
function getCss(a, b) {
  console.log(reg)
	if (reg) {
		getCss = function (a, b) {
			return a + b;
		};
	} else {
		getCss = function (a, b) {
			return a - b;
		};
	}
	// åˆ«å¿˜äº† return
  return getCss(a,b)
}
console.log(getCss(1,2))
console.log(getCss(1,3))
```

## é“¾å¼è°ƒç”¨

```js
function handleClass(el) {
      let methods = {
        addClass,
        removeClass,
      };

      function addClass(c) {
        el.classList.add(c);
        return methods;
      }

      function removeClass(c) {
        el.classList.remove(c);
        return methods;
      }

      return methods;
    }

 handleClass(prevBtn).addClass("disabled").removeClass("active");
```

## AOP ç¼–ç¨‹

åˆ‡é¢ç¼–ç¨‹,ç›¸å½“äºåœ¨é¢åŒ…ç‰‡ä¹‹é—´æŠ¹ä¸Šä¸€å±‚é»„æ²¹,ä¸å½±å“æ ¸å¿ƒä»£ç çš„å®ç°

```js
let say = function (val) {
  console.log(val);
};

Function.prototype.before = function (callback) {
  return () => {
    callback();
    console.log(this);
  };
};

let newSay = say.before(() => {
  console.log("before say");
});

newSay();
```

## å°¾é€’å½’

å°¾é€’å½’çš„è¦æ±‚æ˜¯é€’å½’ return æ˜¯ä¸€ä¸ªå‡½æ•°, `return fn() + 1` ä¸èƒ½ç®—æ˜¯ä¸€ä¸ªå°¾é€’å½’

```js
function factorial(n, total = 1) {
  if (n === 1) return total;
  return factorial(n - 1, n * total);
}

factorial(5) // 120
```

```js
// è¿™é“é¢˜æœ‰ä¸ªè§„å¾‹ï¼Œç¬¬ä¸€é¡¹åŠ ä¸Šç¬¬äºŒé¡¹æ°¸è¿œç­‰äºç¬¬ä¸‰é¡¹ï¼š
// 1 + 1 = 2ï¼›1 + 2 = 3ï¼›2 + 3  // = 5ï¼›3 + 5 = 8 ....

// å€’åºç›¸åŠ 
function factorial(n) {
  // ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹éƒ½è¿”å›1
  if (n === 1 || n === 2) return 1;
  // æˆ‘ä»¬åªè¦è¿”å› n - 1ï¼ˆnçš„å‰ä¸€é¡¹ï¼‰ä¸ n - 2ï¼ˆnçš„å‰ä¸¤é¡¹ï¼‰çš„å’Œä¾¿æ˜¯æˆ‘ä»¬è¦çš„å€¼
  return factorial(n - 1) + factorial(n - 2);
}


function factorial(n, sum1 = 1, sum2 = 1) { // æ±‚æœ€ç»ˆçš„å€¼ï¼Œä¸æ˜¯æ±‚å’Œ
  if (n === 1 || n === 2) return sum2;
  return factorial(n - 1, sum2, sum1 + sum2);
}
```

## å‡½æ•°å®ç°

### é“¾è¡¨

```js
/*
How it works:
`this.#head` is an instance of `Node` which keeps track of its current value and nests another instance of `Node` that keeps the value that comes after it. When a value is provided to `.enqueue()`, the code needs to iterate through `this.#head`, going deeper and deeper to find the last value. However, iterating through every single item is slow. This problem is solved by saving a reference to the last value as `this.#tail` so that it can reference it to add a new value.
*/

class Node {
	value;
	next;

	constructor(value) {
		this.value = value;
	}
}

export default class Queue {
	#head;
	#tail;
	#size;

	constructor() {
		this.clear();
	}

	enqueue(value) {
		const node = new Node(value);

		if (this.#head) {
			this.#tail.next = node;
			this.#tail = node;
		} else {
			this.#head = node;
			this.#tail = node;
		}

		this.#size++;
	}

	dequeue() {
		const current = this.#head;

		if (!current) {
			return;
		}

		this.#head = this.#head.next;
		this.#size--;
		return current.value;
	}

	clear() {
		this.#head = undefined;
		this.#tail = undefined;
		this.#size = 0;
	}

	get size() {
		return this.#size;
	}

	* [Symbol.iterator]() {
		let current = this.#head;

		while (current) {
			yield current.value;
			current = current.next;
		}
	}
}
```
## è¿­ä»£å™¨å‡½æ•°
:::tip
`yield` å‡ºäº§
:::
æ‰§è¡Œ `generator`  æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨  
è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« `next` æ–¹æ³•ï¼Œè°ƒç”¨ `next` æ–¹æ³•æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡  
åŒ…å« `value` å’Œ `done` å±æ€§ï¼Œ`value` è¡¨ç¤ºå½“å‰è¿­ä»£åˆ°çš„å€¼ï¼Œ`done` è¡¨ç¤ºæ˜¯å¦è¿­ä»£å®Œæˆ

```js
let generator = function* (n) {
  console.log(n) // 10
  yield 1;
  yield 2;
};

let iterator = generator(10);
let a = iterator.next(); // { value: 1, done: false}
let b = iterator.next();  // { value: 2, done: false}
```